<!DOCTYPE html>
<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Karla:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="index.css">
    <title>Secret Fans</title>
  </head>
  <body>
    <div class="container">
      <h1>Secret Fans</h1>
      <div class="post-container" id="post-container">
      </div>
      <div class="input-container">
        <h3>Submit a comment:</h3>
        <textarea placeholder="Dear..." rows="3" class="message-input" id="content"></textarea>
      </div>
      <div class="button-container">
        <button class="button" id="submit-comment">Send</button>
      </div>
      <h2>Comments</h2>
      <div class="comment-container" id="comment-container"></div>
    </div>
  </body>
  <script>
    $(document).ready(function() {
      var searchParams = new URLSearchParams(window.location.search);
      var postId = searchParams.get('post_id');

      $.ajax({
        url: "http://localhost:8000/posts/" + postId,
        crossDomain: true,
        dataType: "json",
      })
      .done(function(data) {
        $("#post-container").append("<div class='post-item'><h3>To:</h3><p>" + data["post"].recipient + "</p><h3>Message:</h3><p>"+ data["post"].content +"</p></div>");
      });

      $.ajax({
        url: "http://localhost:8000/comments/" + postId,
        crossDomain: true,
        dataType: "json",
      })
      .done(function(data) {
        $.each(data["comments"], function(index, comment) {
          $("#comment-container").append("<div class='comment-item'><p>"+ comment.content +"</p></div>");
        });
      });

      $("#submit-comment").click(function() {
        var content = $("#content");
        $.ajax({ 
            url: "http://localhost:8000/comments/" + postId,
            data: {"content": content.val()},
            type: "POST",
            success: function(message) {
              location.reload();
            }
        });
      });
    });
  </script>
</html>